#!/usr/bin/env node
var path = require("path");
var libString = require("../lib/js/string");
var Disp = require("../src/disp");
var log = require("../lib/nodejs/log");
log.setLevel(2);
function parseArgv(){
	//init global
	var env = {};
	env.argv = [];
	env.global = {};
	var ParamsHelp = {
		"p": "project path, default '.'",
		"t": "target path, default '.', can be configured in disp.json",
		"x": "extra disp.json file to extend",
		"v": "verbose mode"
	}
	env.global.nodeBin = process.argv.shift();
	env.global.dispBin = process.argv.shift();
	var op = process.argv.shift();
	while(op){
		switch(op){
			case "-p":
			env.projectDir = path.resolve(process.argv.shift());
			break;
			case "-t":
			env.targetDir = path.resolve(process.argv.shift());
			break;
			case "-x":
			env.exDispJsonFile = path.resolve(process.argv.shift());
			break;
			case "-v":
			log.setLevel(3);
			log.v("verbose mode enabled");
			break;
			case "-h":
			throw libString.makeArgvHelp(ParamsHelp);
			break;
			default:
			env.argv.push(op);
		}
		op = process.argv.shift();
	}
	log.v(env);
	return env;
}

var disp = new Disp(parseArgv());
disp.run();
