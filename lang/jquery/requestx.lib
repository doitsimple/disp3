^^deps.append1 = 1;$$
requestx = new Req();
function Req(defaultOptions, uastr){
	function ajax(config, fn){
		if(!config.url.match(":\/")) config.url = "http://" + config.url;
		var urlParsed = url.parse(config.url);
		var options = {};
		extend(options, defaultOptions);
		extend(options, {
			host: urlParsed.hostname,
			path: urlParsed.path,
			method: config.method || "get"
		});
		if(urlParsed.port) options.port = urlParsed.port;		
		extend(options.headers, config.headers);
		var protocol = urlParsed.protocol || "http:";
		var req;
		if(protocol == "http:"){
			req = http.request(options);
		}else if(protocol == "https:"){
			req = https.request(options);
		}else{
			if(fn) fn("wrong protocol " + protocol);
			return;
		}
		if(config.data){
			if(typeof config.data === "string"){
				req.write(config.data);
			}else{
				console.error("data is not string");
				console.error(config.data);
			}
		}
		if(config.stream){
			config.stream.pipe(req);
		}
		req.once("response", function(res){
			if(config.returnStream)
				fn(null, res);
			else
				parseRes(res, fn);
		});

		req.on('error', function(error) {
			if(fn) fn(error);
		});
		req.end();

	}
}
